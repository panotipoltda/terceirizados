<script>
  const sb = supabase.createClient(
    "https://wzucstbnqrmbylumrmit.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6dWNzdGJucXJtYnlsdW1ybWl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3MzMzNzQsImV4cCI6MjA3MTMwOTM3NH0.FSl33Em1Ri3mPwsIY1yaangNdAnqLAXOFf6bH9e1Ibg"
  );

  const form = document.getElementById('f');
  const status = document.getElementById('status');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    status.textContent = "Enviando...";
    status.className = "";

    const data = Object.fromEntries(new FormData(form).entries());
    data.cpf = (data.cpf || "").replace(/\D/g, "");
    data.pis = (data.pis || "").replace(/\D/g, "");

    const { data: res, error, status: http } = await sb
      .from('terceirizados')
      .insert([data]); // sem .select()

    console.log({ http, res, error });

    if (error) {
      status.textContent = `Erro: ${error.message}`;
      status.className = "err";
      return;
    }
    status.textContent = `OK (HTTP ${http}). Registro salvo.`;
    status.className = "ok";
    form.reset();
  });
</script>
